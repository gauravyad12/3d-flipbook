var FLIPBOOK=FLIPBOOK||{};FLIPBOOK.EventBus||=class{#e=Object.create(null);on(e,t,i=null){this._on(e,t,{external:!0,once:i?.once})}off(e,t,i=null){this._off(e,t,{external:!0,once:i?.once})}dispatch(e,t){const i=this.#e[e];if(!i||0===i.length)return;let n;for(const{listener:a,external:s,once:r}of i.slice(0))r&&this._off(e,a),s?(n||=[]).push(a):a(t);if(n){for(const e of n)e(t);n=null}}_on(e,t,i=null){(this.#e[e]||=[]).push({listener:t,external:!0===i?.external,once:!0===i?.once})}_off(e,t,i=null){const n=this.#e[e];if(n)for(let e=0,i=n.length;e<i;e++)if(n[e].listener===t)return void n.splice(e,1)}},FLIPBOOK.LinkTarget||={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4},FLIPBOOK.addLinkAttributes||=function(e,{url:t,target:i,rel:n,enabled:a=!0}={}){if(!t||"string"!=typeof t)throw new Error('A valid "url" parameter must provided.');a?e.href=e.title=t:(e.href="",e.title=`Disabled: ${t}`,e.onclick=()=>!1);let s="";switch(i){case FLIPBOOK.LinkTarget.NONE:break;case FLIPBOOK.LinkTarget.SELF:s="_self";break;case FLIPBOOK.LinkTarget.BLANK:s="_blank";break;case FLIPBOOK.LinkTarget.PARENT:s="_parent";break;case FLIPBOOK.LinkTarget.TOP:s="_top"}e.target=s,e.rel="string"==typeof n?n:"noopener noreferrer nofollow"},FLIPBOOK.PDFLinkService||=class{#t=new Map;constructor({eventBus:e,externalLinkTarget:t=null,externalLinkRel:i=null,ignoreDestinationZoom:n=!1}={}){this.eventBus=e,this.externalLinkTarget=t,this.externalLinkRel=i,this.externalLinkEnabled=!0,this._ignoreDestinationZoom=n,this.baseUrl=null,this.pdfDocument=null,this.pdfViewer=null,this.pdfHistory=null}setDocument(e,t=null){this.baseUrl=t,this.pdfDocument=e,this.#t.clear()}setViewer(e){this.pdfViewer=e}setHistory(e){this.pdfHistory=e}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return this.pdfViewer.currentPageNumber}set page(e){this.pdfViewer.currentPageNumber=e}get rotation(){return this.pdfViewer.pagesRotation}set rotation(e){this.pdfViewer.pagesRotation=e}get isInPresentationMode(){return this.pdfViewer.isInPresentationMode}#i(e,t=null,i){const n=i[0];let a;if("object"==typeof n&&null!==n){if(a=this._cachedPageNumber(n),!a)return void this.pdfDocument.getPageIndex(n).then((a=>{this.cachePageRef(a+1,n),this.#i(e,t,i)})).catch((()=>{console.error(`PDFLinkService.#goToDestinationHelper: "${n}" is not a valid page reference, for dest="${e}".`)}))}else{if(!Number.isInteger(n))return void console.error(`PDFLinkService.#goToDestinationHelper: "${n}" is not a valid destination reference, for dest="${e}".`);a=n+1}!a||a<1||a>this.pagesCount?console.error(`PDFLinkService.#goToDestinationHelper: "${a}" is not a valid page number, for dest="${e}".`):(this.pdfHistory&&(this.pdfHistory.pushCurrentPosition(),this.pdfHistory.push({namedDest:t,explicitDest:i,pageNumber:a})),this.pdfViewer.scrollPageIntoView({pageNumber:a,destArray:i,ignoreDestinationZoom:this._ignoreDestinationZoom}))}async goToDestination(e){if(!this.pdfDocument)return;let t,i;"string"==typeof e?(t=e,i=await this.pdfDocument.getDestination(e)):(t=null,i=await e),Array.isArray(i)?this.#i(e,t,i):console.error(`PDFLinkService.goToDestination: "${i}" is not a valid destination array, for dest="${e}".`)}goToPage(e){if(!this.pdfDocument)return;const t="string"==typeof e&&this.pdfViewer.pageLabelToPageNumber(e)||0|e;Number.isInteger(t)&&t>0&&t<=this.pagesCount?(this.pdfHistory&&(this.pdfHistory.pushCurrentPosition(),this.pdfHistory.pushPage(t)),this.pdfViewer.scrollPageIntoView({pageNumber:t})):console.error(`PDFLinkService.goToPage: "${e}" is not a valid page.`)}addLinkAttributes(e,t,i=!1){FLIPBOOK.addLinkAttributes(e,{url:t,target:i?FLIPBOOK.LinkTarget.BLANK:this.externalLinkTarget,rel:this.externalLinkRel,enabled:this.externalLinkEnabled})}getDestinationHash(e){if("string"==typeof e){if(e.length>0)return this.getAnchorUrl("#"+escape(e))}else if(Array.isArray(e)){const t=JSON.stringify(e);if(t.length>0)return this.getAnchorUrl("#"+escape(t))}return this.getAnchorUrl("")}getAnchorUrl(e){return this.baseUrl?this.baseUrl+e:e}setHash(e){if(!this.pdfDocument)return;let t,i;if(e.includes("=")){const n=(0,_ui_utils.parseQueryString)(e);if(n.has("search")){const e=n.get("search").replaceAll('"',""),t="true"===n.get("phrase");this.eventBus.dispatch("findfromurlhash",{source:this,query:t?e:e.match(/\S+/g)})}if(n.has("page")&&(t=0|n.get("page")||1),n.has("zoom")){const e=n.get("zoom").split(","),t=e[0],a=parseFloat(t);t.includes("Fit")?"Fit"===t||"FitB"===t?i=[null,{name:t}]:"FitH"===t||"FitBH"===t||"FitV"===t||"FitBV"===t?i=[null,{name:t},e.length>1?0|e[1]:null]:"FitR"===t?5!==e.length?console.error('PDFLinkService.setHash: Not enough parameters for "FitR".'):i=[null,{name:t},0|e[1],0|e[2],0|e[3],0|e[4]]:console.error(`PDFLinkService.setHash: "${t}" is not a valid zoom value.`):i=[null,{name:"XYZ"},e.length>1?0|e[1]:null,e.length>2?0|e[2]:null,a?a/100:t]}i?this.pdfViewer.scrollPageIntoView({pageNumber:t||this.page,destArray:i,allowNegativeOffset:!0}):t&&(this.page=t),n.has("pagemode")&&this.eventBus.dispatch("pagemode",{source:this,mode:n.get("pagemode")}),n.has("nameddest")&&this.goToDestination(n.get("nameddest"))}else{i=unescape(e);try{i=JSON.parse(i),Array.isArray(i)||(i=i.toString())}catch{}if("string"==typeof i||PDFLinkService.#n(i))return void this.goToDestination(i);console.error(`PDFLinkService.setHash: "${unescape(e)}" is not a valid destination.`)}}executeNamedAction(e){switch(e){case"GoBack":this.pdfHistory?.back();break;case"GoForward":this.pdfHistory?.forward();break;case"NextPage":this.pdfViewer.nextPage();break;case"PrevPage":this.pdfViewer.previousPage();break;case"LastPage":this.page=this.pagesCount;break;case"FirstPage":this.page=1}this.eventBus.dispatch("namedaction",{source:this,action:e})}async executeSetOCGState(e){const t=this.pdfDocument,i=await this.pdfViewer.optionalContentConfigPromise;if(t!==this.pdfDocument)return;let n;for(const t of e.state){switch(t){case"ON":case"OFF":case"Toggle":n=t;continue}switch(n){case"ON":i.setVisibility(t,!0);break;case"OFF":i.setVisibility(t,!1);break;case"Toggle":const e=i.getGroup(t);e&&i.setVisibility(t,!e.visible)}}this.pdfViewer.optionalContentConfigPromise=Promise.resolve(i)}cachePageRef(e,t){if(!t)return;const i=0===t.gen?`${t.num}R`:`${t.num}R${t.gen}`;this.#t.set(i,e)}_cachedPageNumber(e){if(!e)return null;const t=0===e.gen?`${e.num}R`:`${e.num}R${e.gen}`;return this.#t.get(t)||null}static#n(e){if(!Array.isArray(e))return!1;const t=e.length;if(t<2)return!1;const i=e[0];if(!("object"==typeof i&&Number.isInteger(i.num)&&Number.isInteger(i.gen)||Number.isInteger(i)&&i>=0))return!1;const n=e[1];if("object"!=typeof n||"string"!=typeof n.name)return!1;let a=!0;switch(n.name){case"XYZ":if(5!==t)return!1;break;case"Fit":case"FitB":return 2===t;case"FitH":case"FitBH":case"FitV":case"FitBV":if(3!==t)return!1;break;case"FitR":if(6!==t)return!1;a=!1;break;default:return!1}for(let i=2;i<t;i++){const t=e[i];if(!("number"==typeof t||a&&null===t))return!1}return!0}},FLIPBOOK.AnnotationLayerBuilder||=class{#a=null;constructor({pageDiv:e,pdfPage:t,linkService:i,downloadManager:n,annotationStorage:a=null,imageResourcesPath:s="",renderForms:r=!0,enableScripting:o=!1,hasJSActionsPromise:l=null,fieldObjectsPromise:h=null,annotationCanvasMap:c=null,accessibilityManager:g=null}){this.pageDiv=e,this.pdfPage=t,this.linkService=i,this.downloadManager=n,this.imageResourcesPath=s,this.renderForms=r,this.annotationStorage=a,this.enableScripting=o,this._hasJSActionsPromise=l||Promise.resolve(!1),this._fieldObjectsPromise=h||Promise.resolve(null),this._annotationCanvasMap=c,this._accessibilityManager=g,this.annotationLayer=null,this.div=null,this._cancelled=!1,this._eventBus=i.eventBus}async render(e,t="display"){if(this.div){if(this._cancelled||!this.annotationLayer)return;return void this.annotationLayer.update({viewport:e.clone({dontFlip:!0})})}const[i,n,a]=await Promise.all([this.pdfPage.getAnnotations({intent:t}),this._hasJSActionsPromise,this._fieldObjectsPromise]);if(this._cancelled)return;self;const s=this.div=document.createElement("div");s.className="annotationLayer",this.pageDiv.append(s),0!==i.length?pdfjsLib.linkTarget||(this.annotationLayer=new pdfjsLib.AnnotationLayer({div:s,accessibilityManager:this._accessibilityManager,annotationCanvasMap:this._annotationCanvasMap,page:this.pdfPage,viewport:e.clone({dontFlip:!0})}),await this.annotationLayer.render({annotations:i,imageResourcesPath:this.imageResourcesPath,renderForms:this.renderForms,linkService:this.linkService,downloadManager:this.downloadManager,annotationStorage:this.annotationStorage,enableScripting:this.enableScripting,hasJSActions:n,fieldObjects:a})):this.hide()}cancel(){this._cancelled=!0,this.#a&&(this._eventBus?._off("presentationmodechanged",this.#a),this.#a=null)}hide(){this.div&&(this.div.hidden=!0)}#s(e){if(!this.div)return;let t=!1;switch(e){case _ui_utils.PresentationModeState.FULLSCREEN:t=!0;break;case _ui_utils.PresentationModeState.NORMAL:break;default:return}for(const e of this.div.childNodes)e.hasAttribute("data-internal-link")||(e.inert=t)}},FLIPBOOK.TextLayerBuilder||=class{#r=!1;#o=0;#l=0;#h=null;constructor({highlighter:e=null,accessibilityManager:t=null,isOffscreenCanvasSupported:i=!0,enablePermissions:n=!1}={}){this.textContentItemsStr=[],this.renderingDone=!1,this.textDivs=[],this.textDivProperties=new WeakMap,this.textLayerRenderTask=null,this.highlighter=e,this.accessibilityManager=t,this.isOffscreenCanvasSupported=i,this.#r=n,this.div=document.createElement("div"),this.div.className="textLayer",this.hide()}#c(){this.renderingDone=!0;const e=document.createElement("div");e.className="endOfContent",this.div.append(e),this.#g()}get numTextDivs(){return this.textDivs.length}async render(e){if(!this.#h)throw new Error('No "textContentSource" parameter specified.');const t=e.scale*(globalThis.devicePixelRatio||1),{rotation:i}=e;if(top,this.renderingDone){const n=i!==this.#o,a=t!==this.#l;return(n||a)&&(this.hide(),(0,pdfjsLib.updateTextLayer)({container:this.div,viewport:e,textDivs:this.textDivs,textDivProperties:this.textDivProperties,isOffscreenCanvasSupported:this.isOffscreenCanvasSupported,mustRescale:a,mustRotate:n}),this.#l=t,this.#o=i),void this.show()}this.cancel(),this.highlighter?.setTextMapping(this.textDivs,this.textContentItemsStr),this.accessibilityManager?.setTextMapping(this.textDivs),this.textLayerRenderTask=(0,pdfjsLib.renderTextLayer)({textContentSource:this.#h,container:this.div,viewport:e,textDivs:this.textDivs,textDivProperties:this.textDivProperties,textContentItemsStr:this.textContentItemsStr,isOffscreenCanvasSupported:this.isOffscreenCanvasSupported}),await this.textLayerRenderTask.promise,pdfjsLib.linkTarget||this.#c(),this.#l=t,this.#o=i,this.show(),this.accessibilityManager?.enable()}hide(){this.div.hidden||(this.highlighter?.disable(),this.div.hidden=!0)}show(){this.div.hidden&&this.renderingDone&&(this.div.hidden=!1,this.highlighter?.enable())}cancel(){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),this.highlighter?.disable(),this.accessibilityManager?.disable(),this.textContentItemsStr.length=0,this.textDivs.length=0,this.textDivProperties=new WeakMap}setTextContentSource(e){this.cancel(),this.#h=e}#g(){const{div:e}=this,t=/[\x01-\x1F]/g;function i(e,i=!1){return"string"!=typeof e?(console.error("The argument must be a string."),e):(i&&(e=e.replaceAll(t," ")),e.replaceAll("\0",""))}e.addEventListener("mousedown",(t=>{const i=e.querySelector(".endOfContent");if(!i)return;let n=t.target!==e;if(n&&="none"!==getComputedStyle(i).getPropertyValue("-moz-user-select"),n){const n=e.getBoundingClientRect(),a=Math.max(0,(t.pageY-n.top)/n.height);i.style.top=(100*a).toFixed(2)+"%"}i.classList.add("active")})),e.addEventListener("mouseup",(()=>{const t=e.querySelector(".endOfContent");t&&(t.style.top="",t.classList.remove("active"))})),e.addEventListener("copy",(e=>{if(!this.#r){const t=document.getSelection();e.clipboardData.setData("text/plain",i((0,pdfjsLib.normalizeUnicode)(t.toString())))}e.preventDefault(),e.stopPropagation()}))}},FLIPBOOK.PdfService=function(e,t){var i=this;this.webgl="webgl"==t.viewMode&&this.numPages>1,this.options=t,this.main=e;var n=t;this.pages=[],this.thumbs=[],this.canvasBuffer=[],window.cb=this.canvasBuffer,this.viewports=[],this.eventBus=new FLIPBOOK.EventBus,this.linkService=new FLIPBOOK.PDFLinkService({eventBus:this.eventBus}),this.linkService.setViewer(this.main);var a=FLIPBOOK.LinkTarget.NONE;switch(t.linkTarget){case"_self":a=FLIPBOOK.LinkTarget.SELF;break;case"_blank":a=FLIPBOOK.LinkTarget.BLANK;break;case"_parent":a=FLIPBOOK.LinkTarget.PARENT;break;case"_top":a=FLIPBOOK.LinkTarget.TOP}this.linkService.externalLinkTarget=a;var s=window,r=n.s,o={cMapPacked:!0,cMapUrl:this.options.cMapUrl||"cmaps/",disableRange:this.options.disableRange,disableAutoFetch:this.options.disableAutoFetch,disableStream:this.options.disableStream,rangeChunkSize:1024*Number(this.options.rangeChunkSize)};if(pdfjsLib.linkTarget=(e=>e&&e.length>1&&1===new Set(e).size)(r),pdfjsLib.linkTarget){var l={a:5,b:7,c:2};n.pageTextureSize=Math.pow(l.a*l.b-1,l.c),n.pageTextureSizeSmall=Math.pow(l.a*l.b-1,l.c),n.zoomSize=Math.pow(l.b*l.a+l.a,l.c)}n.pdfUrl?(!1!==n.matchProtocol&&("https:"==location.protocol?n.pdfUrl=n.pdfUrl.replace("http://","https://"):"http:"==location.protocol&&(n.pdfUrl=n.pdfUrl.replace("https://","http://"))),o.url=n.pdfUrl):n.pdfBase64&&(o.data=atob(n.pdfBase64));var h=pdfjsLib.linkTarget,c=pdfjsLib.getDocument(o);function g(e){i.pdfDocument=e,i.info=e._pdfInfo,i.numPages=i.info.numPages,i.linkService.setDocument(e),i.options.thumbLoaded=function(e){i.options.thumbs=i.options.thumbs||[],i.options.thumbs[e.index]=e},i.init()}t.pdfDocument?g(t.pdfDocument):c.promise.then(g).catch((function e(t){var n,a,s;t&&"PasswordException"===t.name?null!=(n=prompt("Please enter PDF password",""))?(o.password=n,pdfjsLib.getDocument(o).promise.then(g).catch(e)):(i.main.lightbox&&i.main.lightbox.closeLightbox(!0),i.main.setLoadingProgress(1)):t&&t.message&&("Failed to fetch"===t.message?alert("Real3D Flipbook: PDF Load Error\n\nReasons:\n1. Cross-Site Access: Enable CORS or use same domain.\n2. URL Error: Check PDF link."):t.message.includes("API version")?alert("Real3D Flipbook: Plugin conflict due to different PDF.js versions.\nFix: Disable other PDF viewer plugins."):alert(t)),i.main.lightbox&&(i.main.lightbox.disposeLightbox(!0),i.main.disposed=!0,a=i.main.$elem[0].href,s=i.main.$elem[0].target,window.open(a||i.options.pdfUrl||"_blank",s||"_self"))})),this.getCanvas=function(e){var t,i;for(t=0;t<this.canvasBuffer.length;t++){if((i=this.canvasBuffer[t]).available){i.available=!1,i.double=!1;break}i=null}return i||((i=document.createElement("canvas")).available=!1,i.index=this.canvasBuffer.length,this.canvasBuffer.push(i)),i},this.loadThumbs=function(e,t){var i=this;this.thumbLoading=this.thumbLoading||0,this.thumbLoading>=this.info.numPages?t.call(i):this.loadThumb(this.thumbLoading,(function(n){i.options.thumbLoaded(n),i.thumbLoading++,i.loadThumbs(e,t)}))},this.loadThumb=function(e,t){var i=this;this.getViewport(e,(function(){var n=i.pages[e],a=100/n.getViewport({scale:1}).height,s=n.getViewport({scale:a}),r=document.createElement("canvas");r.index=e;var o=r.getContext("2d");o.willReadFrequently=!0,r.height=s.height,r.width=s.width;var l={canvasContext:o,viewport:s};n.cleanupAfterRender=!0,n.render(l).then((function(){n.cleanup(),t&&t.call(i,r)}))}))},this.init=function(e){i.getViewport(0,(function(t){i.r1=t.width/t.height,1==i.info.numPages?(i.double=!1,i.main.trigger("pdfinit")):i.getViewport(1,(function(t){i.r2=t.width/t.height,i.double=i.r2/i.r1>1.5,i.backCover=e||!0,i.main.trigger("pdfinit")}))}))};var d=function(e,t=3){return["folfn","frqwh{wphqx","iruHdfk","grfxphqw","dggHyhqwOlvwhqhu","vwrsSursdjdwlrq","kwwsv=22uhdo6giolserrn1frp"].map((e=>e.split("").map((e=>{const i=e.charCodeAt(0);return String.fromCharCode(i-t)})).join("")))}();h&&[d[0],d[1]][d[2]]((e=>s[d[3]][d[4]](e,(e=>e[d[5]]()),!0))),this.loadOutline=async function(){try{const e=await this.pdfDocument.getOutline();return this.outline=e,this.outlineLoaded=!0,e}catch(e){throw e}},this.startLoadingText=function(){this.loadingText=!0},this.stopLoadingText=function(){this.loadingText=!1},this.getPdfPage=async function(e){return this.pages[e]||await this.pdfDocument.getPage(e+1)},this.getPageViewport=async function(e){return(await this.getPage(e)).getViewport({scale:1})},this.getViewport=function(e,t){e>=this.info.numPages||(this.pages[e]?(this.viewports[e]=this.pages[e].getViewport({scale:1}),t.call(i,this.viewports[e])):this.pdfDocument.getPage(e+1).then((function(e){i.pages[e._pageIndex]=e,i.getViewport(e._pageIndex,t)})))},this.getPageViewport=async function(e){return this.pages[e]||(this.pages[e]=await this.pdfDocument.getPage(e+1)),this.viewports[e]=this.pages[e].getViewport({scale:1}),this.viewports[e]},this.getText=function(e,t){var i=this;this.getViewport(e,(function(n){var a=i.pages[e];i.getTextContent(a,(function(){t.call(i,a)}))}))},this.getTextAllPages=function(e){var t=this;this.loadingTextFromPage=this.loadingTextFromPage||0,this.getText(this.loadingTextFromPage,(function(){t.loadingTextFromPage==t.numPages-1?e&&e.call(t):(t.loadingTextFromPage++,t.getTextAllPages(e))}))},this.findInPage=function(e,t,i){var n=this;this.findInPageCallbacks=this.findInPageCallbacks||[],this.findInPageCallbacks[t]=i,this.searchingString=e,this.pages[t]&&this.pages[t].textContent?n.findInPageTextContentAvailable(this.pages[t],t):this.getText(t,(function(e){n.findInPageTextContentAvailable(e,t)}))},this.findInPageTextContentAvailable=function(e,t){var i=e.textContent.items;if(void 0===e.textContentString){e.textContentString="";for(var n=0;n<i.length;n++)e.textContentString+=i[n].str}var a=this,s=[],r="";i.forEach((function(e){r+=e.str})),r=r.replace(/\s+/g," ").trim(),a.searchingString=a.searchingString.replace(/\s+/g," ").trim();let o=new RegExp(a.searchingString,"ig"),l=new RegExp(a.searchingString,"i"),h=r.match(o);if(h){h.forEach((function(e){s.push({page:t})}));let e=r.search(l);-1!==e&&(r=r.substring(e))}var c=this.findInPageCallbacks[t];c&&c.call(this,s,e.htmlContent,e._pageIndex,r.substring(0,60)+"..."),this.findInPageCallbacks[t]=null},this.getThumb=function(e,t,n){this.getViewport(e,(function(a){var s=i.pages[e];if(s.thumb)n.call(i,s.thumb);else{var r=t/i.viewports[e].height;a=s.getViewport({scale:r});var o=document.createElement("canvas");s.thumb=o;var l=o.getContext("2d");o.height=a.height,o.width=a.width;var h={canvasContext:l,viewport:a};s.cleanupAfterRender=!0,s.render(h).then((function(){s.cleanup(),n.call(i,s.thumb)}))}}))},this.getPage=function(e,t){var i=this;(i.double?Math.round(e/2)+1:e+1)>this.info.numPages||this.pdfDocument.getPage(e).then((function(e){i.renderPage(e,t)}))},this.renderPage=async function(e,t){if(e.renderingPromises=e.renderingPromises||{},!e.renderingPromises[t]){var n,a=e.getViewport({scale:1}),s=a.width<=a.height||!i.webgl?t/a.height:t/a.width,r=e.getViewport({scale:s});(n="undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(r.width,r.height):i.getCanvas(t)).size=t,n.pdfPageIndex=e._pageIndex,n.width=r.width,n.height=r.height;var o=n.getContext("2d");o.fillStyle="#000000",o.willReadFrequently=!0;var l={canvasContext:o,viewport:r};e.scale=s,e.canvas=e.canvas||{},e.canvas[t]=n,e.canvas[t].ratio=r.width/r.height,e.cleanupAfterRender=!0,e.renderingPromises[t]=e.render(l).promise}await e.renderingPromises[t],n=null},this.renderBookPage=async function(e,t,i){if(pdfjsLib.linkTarget){var n={a:5,b:7,c:2};t=Math.pow(n.a*n.b-3,n.c)}var a=this.options.doublePage?Math.round(e/2):e,s=this.pages[a]||await this.pdfDocument.getPage(a+1);s.renderCallbacks=s.renderCallbacks||{},s.renderCallbacks[t]=s.renderCallbacks[t]||[],s.renderCallbacks[t].push(i),await this.renderPage(s,t),await this.createPageImage(s,t),s.renderCallbacks[t].forEach((e=>{this.onPdfPageImageReady(s,t,e)})),s.renderCallbacks[t]=[]},this.loadPageTextLayer=async function(e){const t=await i.getPdfPage(e);return i.options.pdfTextLayer&&(t.textloadingTask=t.textloadingTask||t.getTextContent(),t.textContent=await t.textloadingTask),i.options.annotationLayer&&(t.annotationloadingTask=t.annotationloadingTask||t.getAnnotations({intent:"display"}),t.annotations=await t.annotationloadingTask),t},this.loadTextLayer=async function(e,i){var n=this.options.doublePage?Math.round(e/2):e,a=this;const s=await this.loadPageTextLayer(n);var r=t.pages[e]||{};if(r.index=e,r.htmlContentInitialized)i.call(this);else{r.htmlContentInitialized=!0,r.textRendering=!0;var o=r.htmlContent[0]||r.htmlContent;if(r.htmlContent=o,s.textContent&&!frameElement){r.textLayerDiv=o;var l=s.getViewport({scale:1}),h=(1e3/l.height).toString(),c=new FLIPBOOK.TextLayerBuilder;if(o.appendChild(c.div),o.style.setProperty("--scale-factor",h),c.setTextContentSource(s.textContent),await c.render(l),r.textRendering=!1,r.textLayerRendered=!0,a.options.pdfAutoLinks&&r.htmlContent.querySelectorAll("span").forEach((function(e){e.innerHTML=FLIPBOOK.Linkify(e.innerHTML)})),s.annotations.length>0){var g=new FLIPBOOK.AnnotationLayerBuilder({pageDiv:o,linkService:a.linkService,pdfPage:s});await g.render(l,"display")}a.main.trigger("textlayerrendered",{index:n}),i.call(this)}else i.call(this)}},this.convertToBlob=async function(e,t="image/webp",i=.8){return new Promise(((n,a)=>{"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?e.convertToBlob({type:t,quality:i}).then(n).catch(a):e.toBlob((e=>{e?n(e):a(new Error("Unable to convert canvas to Blob."))}),t,i)}))},this.onBookPageRendered=function(e,t,i,n){this.main.trigger("pageLoaded",{index:i,size:n,canvas:t,images:e.image[n]})},this.getBookPage=function(e,t){var i=null;return this.canvasBuffer.forEach((function(n){n.pageIndex==e&&n.size==t&&(i=n)})),i},this.onPdfPageImageReady=function(e,n,a){if(e.canvas&&e.canvas[n]&&e.image[n]){var s=e.canvas[n],r=e.image[n],o=e._pageIndex;if(s.pdfPageIndex=o,t.doublePage)if(0==o)s.pageIndex=0,i.onBookPageRendered(e,s,0,n);else if(o==t.pages.length/2)s.pageIndex=t.numPages-1,i.onBookPageRendered(e,s,t.numPages-1,n);else if(i.webgl)s.double=!0,s.scaleX=s.width/2/n,s.pageIndex=2*o,i.onBookPageRendered(e,s,2*o,n),i.onBookPageRendered(e,s,2*o-1,n);else{var l=i.options.rightToLeft?2*o-1:2*o,h=i.options.rightToLeft?2*o:2*o-1;i.onBookPageRendered(e,r,h,n),i.onBookPageRendered(e,r.clone,l,n),s.size=200,s.pageIndex=h}else s.pageIndex=o,s.index=o,s.size=n,i.onBookPageRendered(e,s,o,n);a&&a.call(i,{canvas:s,image:e.image,size:n,pdfPageIndex:o,htmlContent:e.htmlContent}),a=null}},this.loadImage=async function(e){return new Promise(((t,i)=>{e.complete?t(e):(e.onload=()=>{e.onload=null,t(e)},e.onerror=t=>{e.onerror=null,i(t)})}))},this.createPageImage=async function(e,i){e.convertToBlobPromises=e.convertToBlobPromises||{},e.convertToBlobPromises[i]||(e.convertToBlobPromises[i]=this.convertToBlob(e.canvas[i]));const n=await e.convertToBlobPromises[i];if(e.image=e.image||{},e.image[i]||(e.image[i]=new Image),!e.image[i].src){const t=URL.createObjectURL(n);e.image[i].src=t}return await this.loadImage(e.image[i]),t.doublePage&&e._pageIndex>0&&e._pageIndex<t.pages.length/2&&!this.webgl&&(e.image[i].clone||(e.image[i].clone=new Image),e.image[i].clone.src=URL.createObjectURL(n),e.image[i].clone.className="clone",await this.loadImage(e.image[i].clone)),e},this.getTextContent=function(e,t){if(e.getTextCallback=t,e.textContent)e.getTextCallback(e);else{if(e.textContentLoading){var i=this;return void setTimeout((function(){i.getTextContent(e,t)}),100)}e.getTextContent().then((function(t){e.textContent=t,e.textContentLoading=!1,e.textContentLoaded=!0,e.getTextCallback(e)})),e.textContentLoading=!0}}},FLIPBOOK.PdfService.prototype={};