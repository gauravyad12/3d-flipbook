!function(t,n,e){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=e.call(t)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],(function(n){return e.moduleUri=n.uri,e.call(t)})):n in t||(t[n]=e.call(t)||1)&&"function"==typeof define&&define.amd&&define((function(){return t[n]}))}("undefined"!=typeof self?self:this,"MOD3",(function(t){"use strict";var n=Object.prototype.hasOwnProperty,e=Object.prototype.toString,r=(Object.defineProperty,Math),i=r.PI,o=2*i,s=i/2,a=1/i,u=function(){};"undefined"!=typeof global&&e.call(global),"undefined"!=typeof window&&e.call(window);var l={VERSION:"1.0.0",Class:function(t,e,r){arguments.length<2&&(e=t,t=null);var i,o=n.call(e,"constructor")?e.constructor:function(){};for(i in t?(o.prototype=Object.create(t.prototype),o.prototype.$super=function(t){var n={};return function(e,r){var i,o=":"+e;return 1===n[o]?(t.prototype.$super||u).call(this,e,r):(n[o]=1,i=("constructor"===e?t:t.prototype[e]||u).apply(this,r||[]),n[o]=0,i)}}(t)):o.prototype.$super=u,o.prototype.constructor=o,e)n.call(e,i)&&"constructor"!==i&&(o.prototype[i]=e[i]);if(r)for(i in r)n.call(r,i)&&(o[i]=r[i]);return o}};function c(t){t.dispose()}function f(t){t.reset()}function h(t){t.collapse()}l.Constants={PI:i,invPI:a,halfPI:s,doublePI:o,toRad:i/180,toDeg:180/i},l.ModConstant={NONE:0,LEFT:-1,RIGHT:1,X:1,Y:2,Z:4,Xi:0,Yi:1,Zi:2},l.XYZi=[null,0,1,null,2],l.iXYZ=[1,2,4],l.xyz=["x","y","z"],l.XYZ=["X","Y","Z"],l.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,l.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,l.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,l.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,l.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,l.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,l.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,l.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,l.VecArray=l.Array32F,l.XMath={normalize:function(t,n,e){return 0==n-t?1:l.XMath.trim(0,1,(e-t)/n)},toRange:function(t,n,e){var r=n-t;return 0===r?0:t+r*e},inRange:function(t,n,e,r){return!1!==r?e>=t&&e<=n:e>t&&e<n},sign:function(t,n){return 0===t?n||0:t>0?1:-1},trim:function(t,n,e){return e<t?t:e>n?n:e},wrap:function(t,n,e){var r=n-t;return e<t?e+r:e>=n?e-r:e},degToRad:function(t){return t/180*i},radToDeg:function(t){return t/i*180},presicion:function(t,n){var e=r.pow(10,n);return r.round(t*e)/e},uceil:function(t){return t<0?r.floor(t):r.ceil(t)}},l.XMath.clamp=l.XMath.trim,l.Range=l.Class({constructor:function t(n,e){var r=this;if(!(r instanceof t))return new t(n,e);r.start=null!=n?n:0,r.end=null!=e?e:1},name:"Range",start:0,end:1,dispose:function(){var t=this;return t.start=null,t.end=null,t},getSize:function(){return this.end-this.start},move:function(t){this.start+=t,this.end+=t},isIn:function(t){return t>=this.start&&t<=this.end},normalize:function(t){return l.XMath.normalize(this.start,this.end,t)},toRange:function(t){return l.XMath.toRange(this.start,this.end,t)},trim:function(t){return l.XMath.trim(this.start,this.end,t)},interpolate:function(t,n){return l.XMath.toRange(this.start,this.end,n.normalize(t))},toString:function(){return"["+this.start+" - "+this.end+"]"}}),l.Phase=l.Class({constructor:function t(n){if(!(this instanceof t))return new t(n);this.value=n||0},name:"Phase",value:0,dispose:function(){return this.value=null,this},getPhasedValue:function(){return r.sin(this.value)},getAbsPhasedValue:function(){return r.abs(r.sin(this.value))},getNormValue:function(){return.5*(r.sin(this.value)+1)}}),l.Point=l.Class({constructor:function t(n,e){var r=this;if(!(r instanceof t))return new t(n,e);r.x=n||0,r.y=e||0},name:"Point",x:0,y:0,dispose:function(){var t=this;return t.x=null,t.y=null,t},clone:function(){return new l.Point(this.x,this.y)}}),l.Matrix=l.Class(null,{constructor:function t(n,e,r,i){if(!(this instanceof t))return new t(n,e,r,i);this.m=new l.VecArray([null==n?1:n,null==e?0:e,null==r?0:r,null==i?1:i])},name:"Matrix",m:null,dispose:function(){return this.m=null,this},reset:function(){var t=this.m;return t[0]=1,t[1]=0,t[2]=0,t[3]=1,this},rotate:function(t){var n=this.m,e=r.cos(t),i=r.sin(t);return n[0]=e,n[1]=-i,n[2]=i,n[3]=e,this},scale:function(t,n){var e=this.m;return e[0]=1,e[1]=0,e[2]=0,e[3]=1,null!=t&&(e[0]=t,e[3]=t),null!=n&&(e[3]=n),this},multiply:function(t){return l.Matrix.mult(this,t)},transformPoint:function(t){var n=l.Matrix.transform(this,[t.x,t.y]);return new l.Point(n[0],n[1])},transformPointSelf:function(t){var n=l.Matrix.transform(this,[t.x,t.y]);return t.x=n[0],t.y=n[1],t},clone:function(){var t=this.m;return new l.Matrix(t[0],t[1],t[2],t[3])}},{transform:function(t,n){var e=t.m,r=n[0],i=n[1];return n[0]=e[0]*r+e[1]*i,n[1]=e[2]*r+e[3]*i,n},mult:function(t,n){var e=t.m,r=n.m,i=e[0],o=e[1],s=e[2],a=e[3];return e[0]=i*r[0]+o*r[2],e[1]=i*r[1]+o*r[3],e[2]=s*r[0]+a*r[2],e[3]=s*r[1]+a*r[3],t}}),l.Vector3=l.Class(null,{constructor:function t(n,e,r){if(!(this instanceof t))return new t(n,e,r);var i=new l.VecArray(3);n&&3===n.length?(i[0]=n[0]||0,i[1]=n[1]||0,i[2]=n[2]||0):(i[0]=n||0,i[1]=e||0,i[2]=r||0),this.xyz=i},name:"Vector3",xyz:null,dispose:function(){return this.xyz=null,this},getXYZ:function(){return new l.VecArray(this.xyz)},getXYZRef:function(){return this.xyz},setXYZ:function(t){var n=this.xyz;return n[0]=t[0],n[1]=t[1],n[2]=t[2],this},setXYZRef:function(t){return this.xyz=t,this},clone:function(){return new l.Vector3(this.xyz)},equalsSelf:function(t){var n=this.xyz,e=t.xyz;return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},zeroSelf:function(){var t=this.xyz;return t[0]=0,t[1]=0,t[2]=0,this},negate:function(){var t=this.xyz;return new l.Vector3(-t[0],-t[1],-t[2])},negateSelf:function(){var t=this.xyz;return t[0]=-t[0],t[1]=-t[1],t[2]=-t[2],this},add:function(t){var n=this.xyz,e=t.xyz;return new l.Vector3(n[0]+e[0],n[1]+e[1],n[2]+e[2])},addSelf:function(t){var n=this.xyz,e=t.xyz;return n[0]+=e[0],n[1]+=e[1],n[2]+=e[2],this},subtract:function(t){var n=this.xyz,e=t.xyz;return new l.Vector3(n[0]-e[0],n[1]-e[1],n[2]-e[2])},subtractSelf:function(t){var n=this.xyz,e=t.xyz;return n[0]-=e[0],n[1]-=e[1],n[2]-=e[2],this},multiplyScalar:function(t){var n=this.xyz;return new l.Vector3(n[0]*t,n[1]*t,n[2]*t)},multiplyScalarSelf:function(t){var n=this.xyz;return n[0]*=t,n[1]*=t,n[2]*=t,this},multiply:function(t){var n=this.xyz,e=t.xyz;return new l.Vector3(n[0]*e[0],n[1]*e[1],n[2]*e[2])},multiplySelf:function(t){var n=this.xyz,e=t.xyz;return n[0]*=e[0],n[1]*=e[1],n[2]*=e[2],this},divide:function(t){var n=this.xyz;return new l.Vector3(n[0]/t,n[1]/t,n[2]/t)},divideSelf:function(t){var n=this.xyz;return n[0]/=t,n[1]/=t,n[2]/=t,this},normalize:function(){var t,n=this.xyz,e=n[0],i=n[1],o=n[2],s=e*e+i*i+o*o;return 0<s&&(e/=t=r.sqrt(s),i/=t,o/=t),new l.Vector3(e,i,o)},normalizeSelf:function(){var t,n=this.xyz,e=n[0],i=n[1],o=n[2],s=e*e+i*i+o*o;return 0<s&&(e/=t=r.sqrt(s),i/=t,o/=t),n[0]=e,n[1]=i,n[2]=o,this},getMagnitude:function(){var t=this.xyz,n=t[0],e=t[1],i=t[2];return r.sqrt(n*n+e*e+i*i)},setMagnitude:function(t){this.normalizeSelf();var n=this.xyz;return n[0]*=t,n[1]*=t,n[2]*=t,this},dot:function(t){var n=this.xyz,e=t.xyz;return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},cross:function(t){var n=this.xyz,e=t.xyz,r=n[0],i=n[1],o=n[2],s=e[0],a=e[1],u=e[2];return new l.Vector3(i*u-o*a,o*s-r*u,r*a-i*s)},crossSelf:function(t){t=this.xyz;var n=b.xyz,e=t[0],r=t[1],i=t[2],o=n[0],s=n[1],a=n[2];return t[0]=r*a-i*s,t[1]=i*o-e*a,t[2]=e*s-r*o,this},distance:function(t){var n=this.xyz,e=t.xyz,i=n[0]-e[0],o=n[1]-e[1],s=n[2]-e[2];return r.sqrt(i*i+o*o+s*s)},toString:function(){var t=this.xyz;return"["+t[0]+" , "+t[1]+" , "+t[2]+"]"}},{ZERO:function(){return new l.Vector3(0,0,0)},X:function(t){return!1===t?new l.Vector3(0,1,1):new l.Vector3(1,0,0)},Y:function(t){return!1===t?new l.Vector3(1,0,1):new l.Vector3(0,1,0)},Z:function(t){return!1===t?new l.Vector3(1,1,0):new l.Vector3(0,0,1)},dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},equals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]},cross:function(t,n){var e=new l.VecArray(3);return e[0]=t[1]*n[2]-t[2]*n[1],e[1]=t[2]*n[0]-t[0]*n[2],e[2]=t[0]*n[1]-t[1]*n[0],e},mod:function(t){var n=t[0],e=t[1],i=t[2];return r.sqrt(n*n+e*e+i*i)},dist:function(t,n){var e=t[0]-n[0],i=t[1]-n[1],o=t[2]-n[2];return r.sqrt(e*e+i*i+o*o)},add:function(t,n){return t[0]+=n[0],t[1]+=n[1],t[2]+=n[2],t},sub:function(t,n){return t[0]-=n[0],t[1]-=n[1],t[2]-=n[2],t},mul:function(t,n){return t[0]*=n[0],t[1]*=n[1],t[2]*=n[2],t},muls:function(t,n){return t[0]*=n,t[1]*=n,t[2]*=n,t},norm:function(t){var n,e=t[0],i=t[1],o=t[2],s=e*e+i*i+o*o;return 0<s&&(e/=n=r.sqrt(s),i/=n,o/=n),t[0]=e,t[1]=i,t[2]=o,t}}),l.Vector3.modulo=l.Vector3.mod,l.Vector3.distance=l.Vector3.dist,l.Vector3.prototype.dotSelf=l.Vector3.prototype.dot,l.Vector3.prototype.distanceSelf=l.Vector3.prototype.distance,l.Matrix4=l.Class(null,{constructor:function t(n,e,r,i,o,s,a,u,c,f,h,d,p,m,x,y){if(!(this instanceof t))return new t(n,e,r,i,o,s,a,u,c,f,h,d,p,m,x,y);this.m=new l.VecArray([null==n?1:n,null==e?0:e,null==r?0:r,null==i?0:i,null==o?0:o,null==s?1:s,null==a?0:a,null==u?0:u,null==c?0:c,null==f?0:f,null==h?1:h,null==d?0:d,null==p?0:p,null==m?0:m,null==x?0:x,null==y?1:y])},name:"Matrix4",m:null,dispose:function(){return this.m=null,this},reset:function(){var t=this.m;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},translate:function(t,n,e,r){var i=this.m;return!0===r&&this.reset(),i[3]=t,i[7]=n,i[11]=e,this},scale:function(t,n,e,r){var i=this.m;return!0===r&&this.reset(),i[0]=t,i[5]=n,i[10]=e,this},rotate:function(t,n,e,i,o){var s=this.m,a=r.cos(i),u=r.sin(i),l=1-a,c=t*n*l,f=n*e*l,h=t*e*l,d=u*e,p=u*n,m=u*t;return!0===o&&this.reset(),s[0]=a+t*t*l,s[1]=-d+c,s[2]=p+h,s[3]=0,s[4]=d+c,s[5]=a+n*n*l,s[6]=-m+f,s[7]=0,s[8]=-p+h,s[9]=m+f,s[10]=a+e*e*l,s[11]=0,this},translateFromVector:function(t,n){return this.translate(t.xyz[0],t.xyz[1],t.xyz[2],n)},scaleFromVector:function(t,n){return this.scale(t.xyz[0],t.xyz[1],t.xyz[2],n)},rotateFromVector:function(t,n,e){return this.rotate(t.xyz[0],t.xyz[1],t.xyz[2],n,e)},multiply:function(t){return l.Matrix4.mult(this,t)},multiplyVector:function(t){return l.Matrix4.multXYZ(this,t.xyz),t}},{multXYZ:function(t,n){var e=t.m,r=n[0],i=n[1],o=n[2];return n[0]=r*e[0]+i*e[1]+o*e[2]+e[3],n[1]=r*e[4]+i*e[5]+o*e[6]+e[7],n[2]=r*e[8]+i*e[9]+o*e[10]+e[11],n},mult:function(t,n){var e=t.m,r=n.m,i=e[0],o=r[0],s=e[4],a=r[4],u=e[8],l=r[8],c=e[1],f=r[1],h=e[5],d=r[5],p=e[9],m=r[9],x=e[2],y=r[2],v=e[6],M=r[6],g=e[10],w=r[10],V=e[3],X=r[3],Y=e[7],A=r[7],Z=e[11],C=r[11];return e[0]=i*o+c*a+x*l,e[1]=i*f+c*d+x*m,e[2]=i*y+c*M+x*w,e[3]=i*X+c*A+x*C+V,e[4]=s*o+h*a+v*l,e[5]=s*f+h*d+v*m,e[6]=s*y+h*M+v*w,e[7]=s*X+h*A+v*C+Y,e[8]=u*o+p*a+g*l,e[9]=u*f+p*d+g*m,e[10]=u*y+p*M+g*w,e[11]=u*X+p*A+g*C+Z,t}}),l.Matrix4.prototype.translationMatrix=l.Matrix4.prototype.translate,l.Matrix4.prototype.scaleMatrix=l.Matrix4.prototype.scale,l.Matrix4.prototype.rotationMatrix=l.Matrix4.prototype.rotate,l.Matrix4.prototype.translationMatrixFromVector=l.Matrix4.prototype.translateFromVector,l.Matrix4.prototype.scaleMatrixFromVector=l.Matrix4.prototype.scaleFromVector,l.Matrix4.prototype.rotationMatrixFromVector=l.Matrix4.prototype.rotateFromVector,l.List={operate:function(t,n,e,r,i,o){var s=t.length;if(arguments.length<5&&(i=s-1),0>i&&(i+=s),arguments.length<4&&(r=0),r>i)return e;if(!0===o){var a=(h=i-r+1)-1,u=a-(d=15&h),l=(p=1&d)?n(e,t[i],i):e;for(c=a-p;c>u;c-=2)l=n(n(l,t[f=r+c],f),t[f-1],f-1);for(c=u;c>=0;c-=16)l=n(n(n(n(n(n(n(n(n(n(n(n(n(n(n(n(l,t[f=r+c],f),t[f-1],f-1),t[f-2],f-2),t[f-3],f-3),t[f-4],f-4),t[f-5],f-5),t[f-6],f-6),t[f-7],f-7),t[f-8],f-8),t[f-9],f-9),t[f-10],f-10),t[f-11],f-11),t[f-12],f-12),t[f-13],f-13),t[f-14],f-14),t[f-15],f-15)}else{var c,f,h,d,p;for(l=(p=1&(d=15&(h=i-r+1)))?n(e,t[r],r):e,c=p;c<d;c+=2)l=n(n(l,t[f=r+c],f),t[f+1],f+1);for(c=d;c<h;c+=16)l=n(n(n(n(n(n(n(n(n(n(n(n(n(n(n(n(l,t[f=r+c],f),t[f+1],f+1),t[f+2],f+2),t[f+3],f+3),t[f+4],f+4),t[f+5],f+5),t[f+6],f+6),t[f+7],f+7),t[f+8],f+8),t[f+9],f+9),t[f+10],f+10),t[f+11],f+11),t[f+12],f+12),t[f+13],f+13),t[f+14],f+14),t[f+15],f+15)}return l},each:function(t,n,e,r,i){if(null==t||!t.length)return t;var o=t.length;if(arguments.length<4&&(r=o-1),0>r&&(r+=o),arguments.length<3&&(e=0),e>r)return t;var s,a,u,l,c,f,h=r-e+1;if(!0===i){for(l=(u=h-1)-(c=15&h),(f=1&c)&&n(t[r]),s=u-f;s>l;s-=2)n(t[a=e+s]),n(t[a-1]);for(s=l;s>=0;s-=16)n(t[a=e+s]),n(t[a-1]),n(t[a-2]),n(t[a-3]),n(t[a-4]),n(t[a-5]),n(t[a-6]),n(t[a-7]),n(t[a-8]),n(t[a-9]),n(t[a-10]),n(t[a-11]),n(t[a-12]),n(t[a-13]),n(t[a-14]),n(t[a-15])}else{for((f=1&(c=15&h))&&n(t[e]),s=f;s<c;s+=2)n(t[a=e+s]),n(t[a+1]);for(s=c;s<h;s+=16)n(t[a=e+s]),n(t[a+1]),n(t[a+2]),n(t[a+3]),n(t[a+4]),n(t[a+5]),n(t[a+6]),n(t[a+7]),n(t[a+8]),n(t[a+9]),n(t[a+10]),n(t[a+11]),n(t[a+12]),n(t[a+13]),n(t[a+14]),n(t[a+15])}return t}},l.FaceProxy=l.Class(null,{constructor:function(){this.vertices=[]},name:"FaceProxy",vertices:null,dispose:function(){return this.vertices=null,this},addVertex:function(t){this.vertices.push(t)},getVertices:function(){return this.vertices}}),l.VertexProxy=l.Class(null,{constructor:function(t,n){var e=this;e.mesh=n||null,e.original=new l.VecArray([0,0,0]),e.ratio=new l.VecArray([0,0,0]),null!=t&&e.setVertex(t)},name:"VertexProxy",mesh:null,vertex:null,original:null,ratio:null,dispose:function(){var t=this;return t.mesh=null,t.vertex=null,t.original=null,t.ratio=null,t},setVertex:function(t){return this.vertex=t,this},getRatioVector:function(){var t=this.ratio,n=new l.VecArray(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},getRatio:function(t){return this.ratio[l.XYZi[t]]||0},setRatios:function(t,n,e){var r=this.ratio;return r[0]=t||0,r[1]=n||0,r[2]=e||0,this},getOriginalValue:function(t){return this.original[l.XYZi[t]]||0},setOriginalPosition:function(t,n,e){var r=this.original;return r[0]=t||0,r[1]=n||0,r[2]=e||0,this},getXYZ:function(){return new l.VecArray([0,0,0])},getX:function(){return 0},getY:function(){return 0},getZ:function(){return 0},getValue:function(t){var n=this;return l.ModConstant.X===t?n.getX():l.ModConstant.Y===t?n.getY():l.ModConstant.Z===t?n.getZ():0},setXYZ:function(t){return this},setX:function(t){return this},setY:function(t){return this},setZ:function(t){return this},setValue:function(t,n){var e=this;return l.ModConstant.X===t?e.setX(n):l.ModConstant.Y===t?e.setY(n):l.ModConstant.Z===t&&e.setZ(n),e},reset:function(){var t=this;return t.setXYZ(t.original),t},collapse:function(){var t=this,n=t.getXYZ(),e=t.original;return e[0]=n[0],e[1]=n[1],e[2]=n[2],t}}),l.MeshProxy=l.Class(null,{constructor:function(t){var n=this;n.maxX=0,n.maxY=0,n.maxZ=0,n.minX=0,n.minY=0,n.minZ=0,n.maxAxis=0,n.midAxis=0,n.minAxis=0,n.width=0,n.height=0,n.depth=0,n.vertices=null,n.faces=null,n.mesh=null,null!=t&&n.setMesh(t)},name:"MeshProxy",maxX:0,maxY:0,maxZ:0,minX:0,minY:0,minZ:0,maxAxis:0,midAxis:0,minAxis:0,width:0,height:0,depth:0,vertices:null,faces:null,mesh:null,v:null,dispose:function(){var t=this;return t.maxX=null,t.maxY=null,t.maxZ=null,t.minX=null,t.minY=null,t.minZ=null,t.maxAxis=null,t.midAxis=null,t.minAxis=null,t.width=null,t.height=null,t.depth=null,t.disposeFaces(),t.disposeVertices(),t.mesh=null,t.v=null,t},disposeVertices:function(){var t=this;return t.vertices&&l.List.each(t.vertices,c),t.vertices=null,t},disposeFaces:function(){var t=this;return t.faces&&l.List.each(t.faces,c),t.faces=null,t},init:function(t){return this.mesh=t,this},setMesh:function(t){var n=this;return n.init(t),n.preApply(),n.analyzeGeometry(),n.postApply(),n},getVertices:function(){return this.vertices},getFaces:function(){return this.faces},applyModifiers:function(t){var n,e;for(e=0,n=t.length;e<n;++e)t[e].enabled&&t[e].apply(this);return this},analyzeGeometry:function(){var t,n,e,i,o,s,a=this,u=a.vertices,c=0,f=0,h=0,d=0,p=0,m=0;return u&&u.length?(s=u[0].getXYZ(),c=s[0],f=s[1],h=s[2],d=s[0],p=s[1],m=s[2],l.List.each(u,(function(t){var n=t.getXYZ(),e=n[0],i=n[1],o=n[2];c=r.min(c,e),f=r.min(f,i),h=r.min(h,o),d=r.max(d,e),p=r.max(p,i),m=r.max(m,o),t.setOriginalPosition(e,i,o)})),t=d-c,n=p-f,e=m-h,a.width=t,a.height=n,a.depth=e,a.minX=c,a.maxX=d,a.minY=f,a.maxY=p,a.minZ=h,a.maxZ=m,i=r.max(t,n,e),o=r.min(t,n,e),i===t&&o===n?(a.minAxis=l.ModConstant.Y,a.midAxis=l.ModConstant.Z,a.maxAxis=l.ModConstant.X):i===t&&o===e?(a.minAxis=l.ModConstant.Z,a.midAxis=l.ModConstant.Y,a.maxAxis=l.ModConstant.X):i===n&&o===t?(a.minAxis=l.ModConstant.X,a.midAxis=l.ModConstant.Z,a.maxAxis=l.ModConstant.Y):i===n&&o===e?(a.minAxis=l.ModConstant.Z,a.midAxis=l.ModConstant.X,a.maxAxis=l.ModConstant.Y):i===e&&o===t?(a.minAxis=l.ModConstant.X,a.midAxis=l.ModConstant.Y,a.maxAxis=l.ModConstant.Z):i===e&&o===n&&(a.minAxis=l.ModConstant.Y,a.midAxis=l.ModConstant.X,a.maxAxis=l.ModConstant.Z),l.List.each(u,(function(r){var i=r.getXYZ();r.setRatios(t>0?(i[0]-c)/t:0,n>0?(i[1]-f)/n:0,e>0?(i[2]-h)/e:0)})),a):a},resetGeometry:function(){return l.List.each(this.vertices,f),this},collapseGeometry:function(){var t=this;return l.List.each(t.vertices,h),t.analyzeGeometry(),t},getMin:function(t){var n=this;return l.ModConstant.X===t?n.minX:l.ModConstant.Y===t?n.minY:l.ModConstant.Z===t?n.minZ:-1},getMax:function(t){var n=this;return l.ModConstant.X===t?n.maxX:l.ModConstant.Y===t?n.maxY:l.ModConstant.Z===t?n.maxZ:-1},getSize:function(t){var n=this;return l.ModConstant.X===t?n.width:l.ModConstant.Y===t?n.height:l.ModConstant.Z===t?n.depth:-1},update:function(){return this},preApply:function(){return this},postApply:function(){return this},updateMeshPosition:function(t){return this}}),l.Library3d={id:"Library3d",Mesh:l.MeshProxy,Vertex:l.VertexProxy},l.Factory={getLibrary:function(t){return t&&t.library&&l[t.library]?l[t.library]:l.Library3d},getMeshProxy:function(t){return arguments.length&&t.Mesh?new t.Mesh:null},getModifier:function(t){return t&&t.modifier&&l[t.modifier]?new l[t.modifier]:null}};var d=0;return l.Modifier=l.Class({constructor:function(){var t=this;t.id=++d,t.name="Modifier",t.axes=l.ModConstant.NONE,t.constraint=l.ModConstant.NONE,t.enabled=!0},id:null,name:"Modifier",axes:null,constraint:null,enabled:!0,dispose:function(){var t=this;return t.name=null,t.axes=null,t.constraint=null,t},enable:function(t){return arguments.length?(this.enabled=!!t,this):this.enabled},constraintAxes:function(t){return this.axes=t||l.ModConstant.NONE,this},setConstraint:function(t){return this.constraint=t||l.ModConstant.NONE,this},apply:function(t){return this},toString:function(){return"[Modifier "+this.name+"]"}}),l.ModifierStack=l.Class({constructor:function t(n,e){var r=this;if(!(r instanceof t))return new t(n,e);r.stack=[],r.setModifiable(l.Factory.getMeshProxy(n),e)},name:"ModifierStack",modifiable:null,stack:null,dispose:function(t){var n=this;if(t&&n.stack)for(;n.stack.length;)n.stack.pop().dispose();return n.modifiable&&n.modifiable.dispose(),n.stack=null,n.modifiable=null,n},getModifiable:function(){return this.modifiable},setModifiable:function(t,n){var e=this;return e.modifiable=t,n&&e.modifiable.setMesh(n),e},add:function(t){return t&&this.stack.push(t),this},apply:function(){var t=this,n=t.modifiable,e=t.stack;return n&&e&&e.length&&n.preApply().resetGeometry().applyModifiers(e).postApply().update(),t},collapse:function(){var t=this,n=t.modifiable,e=t.stack;return n&&e&&e.length&&(n.preApply().resetGeometry().applyModifiers(e).collapseGeometry().postApply().update(),e.length=0),t},clear:function(){var t=this;return t.stack&&(t.stack.length=0),t}}),l.ModifierStack.prototype.getMeshInfo=l.ModifierStack.prototype.getModifiable,l.ModifierStack.prototype.addModifier=l.ModifierStack.prototype.add,function(t){t.Pivot=t.Class(t.Modifier,{constructor:function n(e,r,i){var o=this;if(!(o instanceof n))return new n(e,r,i);o.$super("constructor"),o.name="Pivot",o.vector=new t.Vector3(e||0,r||0,i||0)},vector:null,dispose:function(){var t=this;return t.vector.dispose(),t.vector=null,t.$super("dispose"),t},setMeshCenter:function(n){return this.vector=new t.Vector3(-(n.minX+.5*n.width),-(n.minY+.5*n.height),-(n.minZ+.5*n.depth)),this},apply:function(n){var e=this.vector,r=e.xyz;return t.List.each(n.vertices,(function(n){n.setXYZ(t.Vector3.add(n.getXYZ(),r))})),n.updateMeshPosition(e.negate()),this}})}(l),function(t){var n=Math,e=n.PI,r=2*e,i=e/2;t.Bend=t.Class(t.Modifier,{constructor:function n(e,r,i){var o=this;if(!(o instanceof n))return new n(e,r,i);o.$super("constructor"),o.name="Bend",o.constraint=t.ModConstant.NONE,o.switchAxes=!1,o.force=e||0,o.offset=r||0,o.angle=i||0},force:0,offset:0,angle:0,switchAxes:!1,dispose:function(){var t=this;return t.force=null,t.offset=null,t.angle=null,t.switchAxes=null,t.$super("dispose"),t},apply:function(o){var s=this;if(0===s.force)return s;var a=s.constraint,u=s.switchAxes,l=s.force,c=n.min(1,n.max(0,s.offset)),f=s.angle,h=u?o.midAxis:o.maxAxis,d=o.minAxis,p=u?o.maxAxis:o.midAxis,m=o.getSize(h),x=(o.getSize(p),o.getMin(h)),y=(new t.Matrix).rotate(f),v=(new t.Matrix).rotate(-f),M=x+m*c,g=m/e/l,w=r*(m/(g*r));return t.List.each(o.vertices,(function(e){var r,o,s,u,l,f=e.getXYZ(),V=f[t.XYZi[h]],X=f[t.XYZi[p]],Y=f[t.XYZi[d]],A=t.Matrix.transform(y,[V,X]);V=A[0],X=A[1],r=(V-x)/m,t.ModConstant.LEFT===a&&r<=c||t.ModConstant.RIGHT===a&&r>=c||(o=i-w*c+w*r,s=n.sin(o)*(g+Y),u=n.cos(o)*(g+Y),Y=s-g,V=M-u),V=(l=t.Matrix.transform(v,[V,X]))[0],X=l[1],f[t.XYZi[h]]=V,f[t.XYZi[p]]=X,f[t.XYZi[d]]=Y,e.setXYZ(f)})),s}})}(l),function(t){var n=Math;t.Bloat=t.Class(t.Modifier,{constructor:function n(e,r,i){var o=this;if(!(o instanceof n))return new n(e,r,i);o.$super("constructor"),o.name="Bloat",o.radius=e||0,o.a=null==r?.01:r,o.center=i||t.Vector3.ZERO()},radius:0,a:.01,center:null,dispose:function(){var t=this;return t.center.dispose(),t.center=null,t.radius=null,t.a=null,t.$super("dispose"),t},apply:function(e){var r=this,i=r.center.xyz,o=n.max(0,r.radius),s=n.max(0,r.a);return t.List.each(e.vertices,(function(e){var r=t.Vector3.sub(e.getXYZ(),i),a=t.Vector3.mod(r);t.Vector3.muls(t.Vector3.norm(r),a+o*n.exp(-a*s)),e.setXYZ(t.Vector3.add(r,i))})),r}})}(l),function(t){t.Twist=t.Class(t.Modifier,{constructor:function n(e,r,i){var o=this;if(!(o instanceof n))return new n(e,r,i);o.$super("constructor"),o.name="Twist",o.angle=e||0,o.vector=r||t.Vector3.Y(),o.center=i||t.Vector3.ZERO()},angle:0,vector:null,center:null,dispose:function(){var t=this;return t.vector.dispose(),t.vector=null,t.angle=null,t.center.dispose(),t.center=null,t.$super("dispose"),t},apply:function(n){var e=this,r=e.vector.normalizeSelf().xyz,i=e.angle,o=e.center.xyz,s=t.Vector3.mod([.5*n.maxX,.5*n.maxY,.5*n.maxZ]),a=-t.Vector3.dot(r,o),u=new t.Matrix4,l=new t.Matrix4;return t.List.each(n.vertices,(function(n){var e=n.getXYZ(),o=(t.Vector3.dot(e,r)+a)*i/s,c=t.Matrix4.mult(l.rotate(r[0],r[1],r[2],o,!0),u.translate(e[0],e[1],e[2],!0));n.setXYZ([c.m[3],c.m[7],c.m[11]])})),e}})}(l),function(t){var n=Math;t.Skew=t.Class(t.Modifier,{constructor:function n(e,r,i,o){var s=this;if(!(s instanceof n))return new n(e,r,i,o);s.$super("constructor"),s.name="Skew",s.constraint=t.ModConstant.NONE,s.force=null!=e?e:0,s.offset=null!=r?r:.5,s.power=null!=i?i:1,s.falloff=null!=o?o:1,s.inverseFalloff=!1,s.oneSide=!1,s.swapAxes=!1,s.skewAxis=0},force:0,skewAxis:0,offset:.5,power:1,falloff:1,inverseFalloff:!1,oneSide:!1,swapAxes:!1,dispose:function(){var t=this;return t.force=null,t.skewAxis=null,t.offset=null,t.power=null,t.falloff=null,t.inverseFalloff=null,t.oneSide=null,t.swapAxes=null,t.$super("dispose"),t},apply:function(e){var r=this,i=r.constraint,o=r.skewAxis||e.maxAxis,s=r.swapAxes,a=n.min(1,n.max(0,r.offset)),u=r.oneSide,l=!!r.inverseFalloff,c=n.min(1,n.max(0,r.falloff)),f=1-c,h=r.power,d=r.force,p=t.ModConstant.X===o?s?t.ModConstant.Z:t.ModConstant.Y:t.ModConstant.Y===o?s?t.ModConstant.Z:t.ModConstant.X:t.ModConstant.Z===o?s?t.ModConstant.Y:t.ModConstant.X:0;return t.List.each(e.vertices,(function(e){var r,s,m,x,y;y=e.getRatio(o),t.ModConstant.LEFT===i&&y<=a||t.ModConstant.RIGHT===i&&y>a||(r=y-a,u&&0>r&&(r=-r),s=e.getRatio(p),l&&(s=1-s),m=c+s*f,x=(0>r?-1:1)*n.pow(n.abs(r),h),e.setValue(p,e.getValue(p)+d*x*m))})),r}})}(l),function(t){var n=Math;t.Taper=t.Class(t.Modifier,{constructor:function n(e,r,i,o){var s=this;if(!(s instanceof n))return new n(e,r,i,o);s.$super("constructor"),s.name="Taper",s.force=null!=e?e:0,s.power=null!=r?r:1,s.vector=i||t.Vector3.Y(!1),s.vector2=o||t.Vector3.Y()},force:0,power:1,vector:null,vector2:null,dispose:function(){var t=this;return t.vector.dispose(),t.vector2.dispose(),t.vector=null,t.vector2=null,t.force=null,t.power=null,t.$super("dispose"),t},apply:function(e){var r=this,i=r.vector.xyz,o=r.vector2.xyz,s=r.force,a=r.power,u=new t.Matrix4;return t.List.each(e.vertices,1!==a?function(e){var r=t.Vector3.mod(t.Vector3.mul(e.getRatioVector(),o)),l=s*n.pow(r,a);e.setXYZ(t.Matrix4.multXYZ(u.scale(1+l*i[0],1+l*i[1],1+l*i[2]),e.getXYZ()))}:function(n){var e=t.Vector3.mod(t.Vector3.mul(n.getRatioVector(),o)),r=s*e;n.setXYZ(t.Matrix4.multXYZ(u.scale(1+r*i[0],1+r*i[1],1+r*i[2]),n.getXYZ()))}),r}})}(l),function(t){t.Wheel=t.Class(t.Modifier,{constructor:function n(e,r,i,o,s){var a=this;if(!(a instanceof n))return new n(e,r,i,o,s);a.$super("constructor"),a.name="Wheel",a.speed=e||0,a.turn=r||0,a.roll=i||0,a.steerVector=o||t.Vector3.Y(),a.rollVector=s||t.Vector3.Z()},speed:0,turn:0,roll:0,steerVector:null,rollVector:null,dispose:function(){var t=this;return t.speed=null,t.turn=null,t.roll=null,t.steerVector.dispose(),t.rollVector.dispose(),t.steerVector=null,t.rollVector=null,t.$super("dispose"),t},apply:function(n){var e=this,r=e.steerVector.normalizeSelf(),i=e.rollVector.normalizeSelf(),o=e.turn,s=e.roll,a=null,u=null;return e.roll+=e.speed,o?(u=(new t.Matrix4).rotateFromVector(r,o),a=(new t.Matrix4).rotateFromVector(u.multiplyVector(i.clone()),s)):a=(new t.Matrix4).rotateFromVector(i,s),t.List.each(n.vertices,u?function(n){n.setXYZ(t.Matrix4.multXYZ(a,t.Matrix4.multXYZ(u,n.getXYZ())))}:function(n){n.setXYZ(t.Matrix4.multXYZ(a,n.getXYZ()))}),e}})}(l),function(t){var n=Math;t.Break=t.Class(t.Modifier,{constructor:function n(e,r,i){var o=this;if(!(o instanceof n))return new n(e,r,i);o.$super("constructor"),o.name="Break",o.offset=e||0,o.angle=r||0,o.vector=i||t.Vector3.Y(),o.range=new t.Range(0,1)},offset:0,angle:0,vector:null,range:null,dispose:function(){var t=this;return t.vector.dispose(),t.range.dispose(),t.vector=null,t.range=null,t.offset=null,t.angle=null,t.$super("dispose"),t},apply:function(e){var r,i,o=this,s=n.min(1,n.max(0,o.offset)),a=o.range,u=o.angle,l=o.vector.normalizeSelf().xyz;return r=e.minZ+e.depth*s,i=(new t.Matrix4).rotate(l[0],l[1],l[2],u),t.List.each(e.vertices,(function(n){var e=n.getXYZ();e[2]-=r,0<=e[2]&&a.isIn(n.ratio[1])&&t.Matrix4.multXYZ(i,e),e[2]+=r,n.setXYZ(e)})),o}})}(l),function(t){var n=Math;t.Noise=t.Class(t.Modifier,{constructor:function n(e){var r=this;if(!(r instanceof n))return new n(e);r.$super("constructor"),r.name="Noise",r.force=e||0,r.start=0,r.end=1,r.axes=t.ModConstant.X|t.ModConstant.Y|t.ModConstant.Z},force:0,start:0,end:1,dispose:function(){var t=this;return t.force=null,t.start=null,t.end=null,t.$super("dispose"),t},setFalloff:function(t,n){var e=this;return e.start=null!=t?t:0,e.end=null!=n?n:1,e},apply:function(e){var r=this,i=r.axes,o=r.start,s=r.end,a=r.force,u=.5*a,l=e.maxAxis;return 0==i||0==a||t.List.each(e.vertices,(function(e){var r,c,f=n.random()*a-u,h=e.getRatio(l);o<s?h<o?h=0:h>s&&(h=1):o>s?(h=1-h)>o?h=0:h<s&&(h=1):h=1,r=f*h,c=e.getXYZ(),e.setXYZ([c[0]+(i&t.ModConstant.X?r:0),c[1]+(i&t.ModConstant.Y?r:0),c[2]+(i&t.ModConstant.Z?r:0)])})),r}})}(l),function(t){t.DisplaceMap=t.Class(t.Modifier,{constructor:function n(e,r,i){var o=this;if(!(o instanceof n))return new n(e,r,i);o.$super("constructor"),o.name="DisplaceMap",+e===e?(o.force=e||1,o.offset=null==r?127:r):(o.setBitmap(e),o.force=r||1,o.offset=null==i?127:i),o.axes=t.ModConstant.X|t.ModConstant.Y|t.ModConstant.Z},width:null,height:null,bmpData:null,force:1,offset:127,dispose:function(){var t=this;return t.bmpData=null,t.width=null,t.height=null,t.force=null,t.offset=null,t.$super("dispose"),t},setBitmap:function(t){var n=this;return n.bmpData=t?t.data:null,n.width=t?t.width:0,n.height=t?t.height:0,n},apply:function(n){var e=this,r=e.axes,i=e.width,o=e.height,s=e.bmpData,a=e.force,u=e.offset;return r&&s?(t.List.each(n.vertices,(function(n){var e,l,c=n.getXYZ();l=~~((i-1)*n.ratio[0]),e=~~((o-1)*n.ratio[2])*i+l<<2,n.setXYZ([c[0]+(r&t.ModConstant.X?((255&s[e])-u)*a:0),c[1]+(r&t.ModConstant.Y?((255&s[e+1])-u)*a:0),c[2]+(r&t.ModConstant.Z?((255&s[e+2])-u)*a:0)])})),e):e}})}(l),function(t){t.Perlin=t.Class(t.Modifier,{constructor:function n(e,r,i){var o=this;if(!(o instanceof n))return new n(e,r,i);o.$super("constructor"),o.name="Perlin",o.force=null!=e?e:1,o.perlin=r,o.autoRun=null==i||!!i,o.axes=t.ModConstant.X|t.ModConstant.Y|t.ModConstant.Z},speedX:1,speedY:1,perlin:null,force:1,offset:0,autoRun:!0,dispose:function(){var t=this;return t.perlin=null,t.speedX=null,t.speedY=null,t.force=null,t.offset=null,t.autoRun=null,t.$super("dispose"),t},setSpeed:function(t,n){var e=this;return e.speedX=t,e.speedY=n,e},apply:function(n){var e,r,i=this,o=i.axes,s=i.force,a=i.offset,u=i.perlin;return o&&u?(e=u.width,r=u.height,i.autoRun&&(u=i.perlin=function(n,e,r,i,o){var s,a,u,l,c,f=e*r,h=new t.VecArray(f);for(i<0&&(i+=e),o<0&&(o+=r),i=~~i,o=~~o,s=0,a=0,c=0;c<f;++c,++s)s>=e&&(s=0,++a),u=(s+i)%e,l=(a+o)%r,h[c]=n[u+l*e];return h}(u,e,r,i.speedX,i.speedY),u.width=e,u.height=r),t.List.each(n.vertices,(function(n){var i=n.getXYZ(),l=~~((e-1)*n.ratio[0])+~~((r-1)*n.ratio[2])*e;n.setXYZ([i[0]+(o&t.ModConstant.X?(u[l]-a)*s:0),i[1]+(o&t.ModConstant.Y?(u[l]-a)*s:0),i[2]+(o&t.ModConstant.Z?(u[l]-a)*s:0)])})),i):i}})}(l),l}));