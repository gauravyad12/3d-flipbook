var FLIPBOOK=FLIPBOOK||{};FLIPBOOK.BookScroll=function(t,i,o,e){this.options=e,this.main=o,this.singlePage=e.singlePageMode,this.singlePage&&(this.view=1),this.view=1,this.pageWidth=e.pageWidth,this.pageHeight=e.pageHeight,this.rightIndex=0,this.pageGap=16,this.slides=[],this.pagesArr=[],this.leftPage=0,this.rightPage=0,this.rotation=0,this.verticalScroller=t,this.verticalScroller.style.width=this.pageWidth+"px",e.pageGap=this.pageGap;for(let t=0;t<e.numPages;t++){const s=new FLIPBOOK.PageScroll(this,i,o,e,t);this.verticalScroller.appendChild(s.wrapper),s.initObserver(),this.pagesArr.push(s)}this.prevPageEnabled=!1,this.setRightIndex(0),this.currentSlide=0,this.flipping=!1,this.wrapper=i,this.verticalScroller.classList.remove("book"),this.verticalScroller.style.paddingTop=this.pageGap/2+"px",this.verticalScroller.style.paddingBottom=this.pageGap/2+"px",this.iscroll=new IScroll(this.wrapper,{freeScroll:!0,mouseWheel:!0,scrollbars:!0,interactiveScrollbars:!0,zoom:!0,scrollX:!0,scrollY:!0,keepInCenterV:!0,keepInCenterH:!0,preventDefault:!1,zoomMin:.01,zoomMax:10,mouseWheelTimeout:100,disablePointer:!1,disableTouch:!1,disableMouse:!1,momentum:!0}),this.main.on("disableIScroll",(()=>{this.disableIscroll()})),this.main.on("enableIScroll",(()=>{this.enableIscroll()}));var s=this;this.iscroll.on("scrollStart",(function(){s.scrolling=!0})),this.iscroll.on("zoomEnd",(function(){s.updateRightIndex()})),this.iscroll.on("scrollEnd",(function(){s.updateRightIndex(),s.scrolling=!1,s.pagesArr.forEach((t=>{t.visibility>0&&t.load()}))})),this.zoomDisabled=!1,o.on("pageLoaded",(function(t){}))},FLIPBOOK.BookScroll.prototype=Object.create(FLIPBOOK.Book.prototype),FLIPBOOK.BookScroll.prototype.constructor=FLIPBOOK.BookScroll,FLIPBOOK.BookScroll.prototype.enableIscroll=function(){this.iscrollDisabled&&(this.iscroll.enable(),this.iscrollDisabled=!1)},FLIPBOOK.BookScroll.prototype.disableIscroll=function(){this.iscrollDisabled||(this.iscroll.disable(),this.iscroll.initiated=!1,this.iscrollDisabled=!0)},FLIPBOOK.BookScroll.prototype.goToPage=function(t,i){if(!this.enabled)return;if(t>this.options.pages.length&&(t=this.options.pages.length),(this.singlePage||t%2!=0)&&t--,t==this.rightIndex)return;this.enableIscroll(),(isNaN(t)||t<0)&&(t=0);let o=-t*(this.pageHeight+this.pageGap)*this.iscroll.scale,e=-(this.iscroll.scrollerHeight-this.main.wrapperH);o=Math.max(o,e);var s=i?0:600;this.iscroll.scrollTo(0,o,s),this.setRightIndex(t),this.main.turnPageComplete()},FLIPBOOK.BookScroll.prototype.setRightIndex=function(t){t!=this.rightIndex&&(this.rightIndex=t,this.main.turnPageComplete())},FLIPBOOK.BookScroll.prototype.nextPage=function(t){this.goToPage(this.rightIndex+2,t)},FLIPBOOK.BookScroll.prototype.prevPage=function(t){this.goToPage(this.rightIndex,t)},FLIPBOOK.BookScroll.prototype.enablePrev=function(t){this.prevEnabled=t},FLIPBOOK.BookScroll.prototype.enableNext=function(t){this.nextEnabled=t},FLIPBOOK.BookScroll.prototype.isFocusedRight=function(){return this.rightIndex%2==0},FLIPBOOK.BookScroll.prototype.isFocusedLeft=function(){return this.rightIndex%2==1},FLIPBOOK.BookScroll.prototype.updateVisiblePages=function(){},FLIPBOOK.BookScroll.prototype.disable=function(){this.enabled=!1},FLIPBOOK.BookScroll.prototype.enable=function(){this.enabled=!0,this.onResize()},FLIPBOOK.BookScroll.prototype.resize=function(){},FLIPBOOK.BookScroll.prototype.onResize=function(){var t=this.main.wrapperW,i=this.main.wrapperH;0==t||0==i||this.w===t&&this.h===i||(this.w=t,this.h=i,this.zoom&&(this.iscroll.refresh(),this.fit(),this.iscroll.scrollTo(0,this.iscroll.y,0)),this.updateRightIndex())},FLIPBOOK.BookScroll.prototype.updateRightIndex=function(){let t=0,i=0;this.pagesArr.forEach((o=>{o.visibility>t&&(t=o.visibility,i=o.index)})),this.setRightIndex(i)},FLIPBOOK.BookScroll.prototype.zoomIn=function(t,i,o){o&&"mousewheel"===o.type||this.zoomTo(t)},FLIPBOOK.BookScroll.prototype.fitToHeight=function(){this.iscroll.zoom(this.zoom*this.main.wrapperH/this.pageHeight,0,0,0)},FLIPBOOK.BookScroll.prototype.fitToWidth=function(){this.iscroll.zoom(this.zoom*this.main.wrapperW/this.pageWidth,0,0,0)},FLIPBOOK.BookScroll.prototype.fit=function(){this.main.wrapperW/this.main.wrapperH<this.pageWidth/this.pageHeight?this.fitToWidth():this.fitToHeight()},FLIPBOOK.BookScroll.prototype.zoomTo=function(t,i,o,e){if(this.enabled&&!this.zoomDisabled){var s=this.main,l=s.wrapperW,n=s.wrapperH;0!=l&&0!=n&&(this.zoom=t,this.fit(),t>1&&this.disableFlip(),this.onZoom(t))}},FLIPBOOK.BookScroll.prototype.zoomOut=function(t){this.zoomTo(t)},FLIPBOOK.BookScroll.prototype.onZoom=function(t){this.options.main.onZoom(t)},FLIPBOOK.BookScroll.prototype.enable=function(){this.enabled=!0},FLIPBOOK.BookScroll.prototype.disable=function(){this.enabled=!1},FLIPBOOK.BookScroll.prototype.onSwipe=function(t,i,o){},FLIPBOOK.BookScroll.prototype.disableFlip=function(){},FLIPBOOK.BookScroll.prototype.enableFlip=function(){},FLIPBOOK.BookScroll.prototype.enablePan=function(){},FLIPBOOK.BookScroll.prototype.disablePan=function(){},FLIPBOOK.BookScroll.prototype.canFlipNext=function(){return this.rightIndex+1<this.options.numPages},FLIPBOOK.PageScroll=function(t,i,o,e,s,l,n){this.rotation=0,this.bookWrapper=i,this.index=s,this.options=e,this.texture=l,this.html=n,this.index=s,this.wrapper=document.createElement("div"),this.wrapper.className="flipbook-scroll-page",this.wrapper.style.marginBottom=this.options.pageGap+"px",this.main=o,this.book=t,this.inner=document.createElement("div"),this.inner.className="flipbook-scroll-page-inner",this.wrapper.appendChild(this.inner),this.bg=document.createElement("div"),this.bg.className="flipbook-scroll-page-bg",this.inner.appendChild(this.bg),this.html=document.createElement("div"),this.html.className="flipbook-page3-html",this.wrapper.appendChild(this.html),this.html.style.width=1e3*this.options.pageWidth/this.options.pageHeight+"px",this.html.style.transform="scale("+this.options.pageHeight/1e3+") translateZ(0)",this.options.doublePage&&(this.index%2==0&&this.index>0?this.html.style.left="-100%":this.html.style.left="0"),this.preloader=document.createElement("img"),e.pagePreloader?(this.preloader.src=e.pagePreloader,this.preloader.className="flipbook-page-preloader-image"):(this.preloader.src=e.assets.spinner,this.preloader.className="flipbook-page-preloader"),this.inner.appendChild(this.preloader),this.setSize(this.pw,this.ph)},FLIPBOOK.PageScroll.prototype={initObserver:function(){new IntersectionObserver((t=>{const i=t[0].intersectionRatio;i>0?this.show(i):this.hide()}),{root:this.bookWrapper,threshold:[0,.1,.5]}).observe(this.wrapper)},show:function(t){this.visibility=t,this.book.scrolling||this.load(),this.isVisible||(this.bg.style.display="block",this.html.style.display="block",this.isVisible=!0)},load:function(t,i){if(!this.loaded&&0!=this.visibility){this.loaded=!0;var o=this.options.pageTextureSize;if(this.size>=o)return i||this.loadHTML(),void(t&&t.call(this));this.size=o;var e=this,s=this.options.rightToLeft?this.options.numPages-this.index-1:this.index;this.options.main.loadPage(s,o,(function(l){if((l=l||{})&&l.image){var n=l.image[o]||l.image;n.classList.add("page-scroll-img"),e.index%2!=0||"left"!=e.options.pages[s].side&&"right"!=e.options.pages[s].side||(n.clone||(n.clone=new Image,n.clone.src=n.src),n=n.clone),e.bg.appendChild(n),e.options.doublePage&&e.index>0&&e.index%2==0&&(n.style.left="-100%"),e.options.doublePage?0==e.index||e.index==e.options.pages.length-1&&e.options.backCover?n.style.width="100%":n.style.width="200%":n.style.width="100%",e.inner.removeChild(e.preloader)}i||e.loadHTML(),t&&t.call(e)}))}},hide:function(){this.visibility=0,this.isVisible&&(this.bg.style.display="none",this.html.style.display="none",this.isVisible=!1,this.pauseHTML())},pauseHTML:function(){this.html.querySelectorAll("video, audio").forEach((function(t){t.pause()}))},loadHTML:function(){var t=this,i=this.options.rightToLeft?this.options.numPages-this.index-1:this.index;this.htmlContent?this.updateHtmlContent():this.options.main.loadPageHTML(i,(function(i){t.htmlContent=i,t.updateHtmlContent()}))},setSize:function(){this.wrapper.style.width=this.options.pageWidth+"px",this.wrapper.style.height=this.options.pageHeight+"px",this.updateHtmlContent()},updateHtmlContent:function(){var t=this.htmlContent;t&&!this.htmlContentVisible&&(t.jquery&&(t=t[0]),this.htmlContentVisible=!0,this.html.replaceChildren(),this.html.appendChild(t),this.startHTML(),this.main.trigger("showpagehtml",{page:this}))},startHTML:function(){this.book.startPageItems(this.wrapper)}};